@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    var studentId = ViewContext.RouteData.Values["studentId"]?.ToString() ??
                   HttpContextAccessor.HttpContext?.Session.GetString("CurrentStudentId") ??
                   "0";
}

<div class="position-sticky pt-3">
    <!-- Student Profile Summary -->
    <div class="text-center text-white mb-4 p-3 bg-primary bg-opacity-25 rounded">
        <div class="mb-3">
            <i class="fas fa-user-graduate fa-2x text-warning"></i>
        </div>
        <h6 class="mb-1">Student Portal</h6>
        <small>@ViewBag.StudentName</small>
        <div class="mt-2">
            <span class="badge bg-light text-dark">
                <i class="fas fa-id-card"></i> ID: @studentId
            </span>
        </div>
    </div>

    <!-- Student Navigation Menu -->
    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "StudentDashboard")"
               href="@Url.Action("StudentDashboard", "Registration", new { studentId = studentId })">
                <i class="fas fa-tachometer-alt me-2"></i>
                Dashboard
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "StudentPortal")"
               href="@Url.Action("StudentPortal", "Registration", new { studentId = studentId })">
                <i class="fas fa-clipboard-list me-2"></i>
                Course Registration
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "MyGrades")"
               href="@Url.Action("MyGrades", "Registration", new { studentId = studentId })">
                <i class="fas fa-chart-bar me-2"></i>
                My Grades
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "MySchedule")"
               href="@Url.Action("MySchedule", "Registration", new { studentId = studentId })">
                <i class="fas fa-calendar-alt me-2"></i>
                Class Schedule
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "Transcript")"
               href="@Url.Action("Transcript", "Registration", new { studentId = studentId })">
                <i class="fas fa-file-alt me-2"></i>
                Unofficial Transcript
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "AcademicProgress")"
               href="@Url.Action("AcademicProgress", "Registration", new { studentId = studentId })">
                <i class="fas fa-chart-line me-2"></i>
                Academic Progress
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link student-nav-link @IsActive("Registration", "CourseMaterials")"
               href="@Url.Action("CourseMaterials", "Registration", new { studentId = studentId })">
                <i class="fas fa-book me-2"></i>
                Course Materials
            </a>
        </li>
    </ul>

    <!-- Student Quick Stats -->
    <div class="mt-4 p-3 bg-dark bg-opacity-50 rounded text-white">
        <h6 class="border-bottom pb-2">My Academic Stats</h6>
        <div class="small">
            <div class="d-flex justify-content-between mb-2">
                <span>Current GPA:</span>
                <span class="badge bg-success">@(ViewBag.CurrentGPA?.ToString("F2") ?? "0.00")</span>
            </div>
            <div class="d-flex justify-content-between mb-2">
                <span>Credits Earned:</span>
                <span class="badge bg-info">@(ViewBag.PassedHours ?? "0")</span>
            </div>
            <div class="d-flex justify-content-between">
                <span>Current Courses:</span>
                <span class="badge bg-warning">@(ViewBag.CurrentCoursesCount ?? "0")</span>
            </div>
        </div>
    </div>
</div>

@functions {
    public string IsActive(string controller, string action)
    {
        var currentController = ViewContext.RouteData.Values["Controller"]?.ToString();
        var currentAction = ViewContext.RouteData.Values["Action"]?.ToString();

        return (currentController == controller && currentAction == action) ? "active" : "";
    }
}